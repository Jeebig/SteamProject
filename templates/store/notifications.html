{% extends 'base.html' %}
{% block content %}
<div class="flex items-center justify-between mb-4">
  <h1 class="text-2xl font-semibold">Уведомления</h1>
  <div class="flex items-center gap-2">
    <a href="{% url 'store:support_tickets' %}" class="text-sm px-3 py-1 rounded bg-blue-600">Мои обращения</a>
    <a href="{% url 'store:support' %}" class="text-sm px-3 py-1 rounded border border-gray-600">Написать в поддержку</a>
  </div>
</div>
{% if unread %}
  <h2 class="text-lg font-semibold mb-2">Непрочитанные</h2>
  <div class="space-y-2 mb-6">
    {% for n in unread %}
      <div class="bg-gray-900 rounded p-3">
        {% if n.kind == 'profile_comment' %}
          Новый комментарий от {{ n.payload.author }} на профиле {{ n.payload.owner }} — <a class="text-blue-300 underline" href="{{ n.link_url }}">перейти</a>
        {% elif n.kind == 'friend_request' %}
          Заявка в друзья от {{ n.payload.user }} — <a class="text-blue-300 underline" href="/friends/">посмотреть</a>
        {% elif n.kind == 'friend_accept' %}
          {{ n.payload.user }} принял вашу заявку — <a class="text-blue-300 underline" href="{{ n.link_url }}">профиль</a>
        {% elif n.kind == 'price_drop' %}
          Снижение цены: {{ n.payload.game_title }} — было {{ n.payload.old_price }}, стало {{ n.payload.new_price }} (−{{ n.payload.percent }}%) — <a class="text-blue-300 underline" href="{{ n.link_url }}">перейти</a>
        {% elif n.kind == 'support_new' %}
          Новое обращение поддержки: «{% if n.payload.subject %}{{ n.payload.subject }}{% else %}Тикет #{{ n.payload.ticket_id }}{% endif %}» — <a class="text-blue-300 underline" href="{{ n.link_url }}">открыть тикет</a>
        {% elif n.kind == 'support_reply' %}
          Ответ поддержки по тикету «{% if n.payload.subject %}{{ n.payload.subject }}{% else %}Тикет #{{ n.payload.ticket_id }}{% endif %}» — <a class="text-blue-300 underline" href="{{ n.link_url }}">прочитать</a>
        {% elif n.kind == 'support_created' %}
          Вы создали обращение: «{% if n.payload.subject %}{{ n.payload.subject }}{% else %}Тикет #{{ n.payload.ticket_id }}{% endif %}» — <a class="text-blue-300 underline" href="{{ n.link_url }}">открыть</a>
        {% else %}
          Уведомление
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% endif %}
<h2 class="text-lg font-semibold mb-2">Все уведомления</h2>
<div class="space-y-2">
  {% for n in all %}
    <div class="bg-gray-900 rounded p-3 text-sm">
      {{ n.created_at|date:'d.m.Y H:i' }} — 
      {% if n.kind == 'profile_comment' %}
        Комментарий от {{ n.payload.author }} на профиле {{ n.payload.owner }} — <a class="text-blue-300 underline" href="{{ n.link_url }}">перейти</a>
      {% elif n.kind == 'friend_request' %}
        Заявка в друзья от {{ n.payload.user }} — <a class="text-blue-300 underline" href="/friends/">посмотреть</a>
      {% elif n.kind == 'friend_accept' %}
        Дружба с {{ n.payload.user }} — <a class="text-blue-300 underline" href="{{ n.link_url }}">профиль</a>
      {% elif n.kind == 'price_drop' %}
        Снижение цены: {{ n.payload.game_title }} — {{ n.payload.old_price }} → {{ n.payload.new_price }} (−{{ n.payload.percent }}%) — <a class="text-blue-300 underline" href="{{ n.link_url }}">перейти</a>
      {% elif n.kind == 'support_new' %}
        Новое обращение: «{% if n.payload.subject %}{{ n.payload.subject }}{% else %}Тикет #{{ n.payload.ticket_id }}{% endif %}» — <a class="text-blue-300 underline" href="{{ n.link_url }}">открыть</a>
      {% elif n.kind == 'support_reply' %}
        Ответ поддержки: «{% if n.payload.subject %}{{ n.payload.subject }}{% else %}Тикет #{{ n.payload.ticket_id }}{% endif %}» — <a class="text-blue-300 underline" href="{{ n.link_url }}">перейти</a>
      {% elif n.kind == 'support_created' %}
        Вы создали обращение: «{% if n.payload.subject %}{{ n.payload.subject }}{% else %}Тикет #{{ n.payload.ticket_id }}{% endif %}» — <a class="text-blue-300 underline" href="{{ n.link_url }}">открыть</a>
      {% else %}
        Уведомление
      {% endif %}
    </div>
  {% empty %}
    <div class="text-gray-400">Пока нет уведомлений.</div>
  {% endfor %}
</div>
{% endblock %}
